var ajaxurl=ttp.ajaxurl,recipes={onReady:function(){recipes.filterImages(),recipes.addInputs(),recipes.imageUploader(),recipes.ordering(),recipes.removeBtn(),recipes.starRating()},addInputs:function(){jQuery(".btn-ingredient").click(function(e){e.preventDefault();var t=jQuery(this).attr("data-count");jQuery("#ingredientListing").append('<article class="ingredient"><div class="move"><i class="fa fa-bars"></i></div><input type="text" class="measurement" name="ingredients['+t+'][measure]" placeholder="measurement" /><span>-</span><input type="text" class="ingredientTitle" name="ingredients['+t+'][ingredient_title]" placeholder="ingredient" /><div class="remove"><i class="fa fa-close"></i></div></article>'),t++,jQuery(this).attr("data-count",t)}),jQuery(".btn-instruction").click(function(e){e.preventDefault(),jQuery("#instructionListing").append('<article class="instruction"><div class="move"><i class="fa fa-bars"></i></div><input type="text" name="instructions[]" placeholder="cooking step" /><div class="remove"><i class="fa fa-close"></i></div></article>')})},imageUploader:function(){var e;jQuery(".upload-image").click(function(t){t.preventDefault();var a=jQuery(this).parent().attr("data-post"),r=jQuery(".photoWrap").children().length;e=wp.media.frames.meta_image_frame=wp.media({library:{type:"image",uploadedTo:wp.media.view.settings.post.id},multiple:!1}),e.open(),e.on("select",function(){var t=e.state().get("selection").first().toJSON();jQuery(".photoWrap").append('<article class="photo ui-state-default" data-order="'+r+'"><img src="'+t.url+'" alt="" /><div class="remove" data-key="'+r+'"><i class="fa fa-close"></i></div></article>'),recipes.saveImage(a,t.url),e.close()})})},saveImage:function(e,t){jQuery.ajax({url:ajaxurl,type:"GET",data:{postID:e,fieldVal:t,action:"setImage"},dataType:"html",success:function(){recipes.removeItem()},error:function(e,t,a){window.alert(e+" :: "+t+" :: "+a)}})},removeItem:function(e,t,a){jQuery.ajax({url:ajaxurl,type:"GET",data:{action:"removeItem",postID:e,type:a,key:t},dataType:"html",error:function(e,t,a){window.alert(e+" :: "+t+" :: "+a)}})},removeBtn:function(){jQuery(".remove").click(function(e){e.preventDefault();var t=jQuery(this).parent().parent().attr("data-post"),a=jQuery(this).parent().parent().attr("data-type"),r=jQuery(this).attr("data-key");jQuery(this).parent().remove(),recipes.removeItem(t,r,a)})},saveOrder:function(e,t,a){jQuery.ajax({url:ajaxurl,type:"GET",data:{order:e,type:t,postID:a,action:"setOrder"},dataType:"JSON"})},ordering:function(){jQuery(".sortable").sortable({placeholder:"ui-state-highlight",update:function(e,t){var a=[];jQuery("article",this).each(function(){a.push(jQuery(this).attr("data-order"))});var r=jQuery(this).attr("data-post"),i=jQuery(this).attr("data-type");recipes.saveOrder(a,i,r)}}),jQuery(".sortable").disableSelection()},starRating:function(){var e=jQuery("#recipe_rating").val();jQuery('#starRating i[data-star="'+e+'"]').addClass("active").prevAll().addClass("active")},filterImages:function(){jQuery(document).on("DOMNodeInserted",function(){jQuery('select.attachment-filters [value="uploaded"]').attr("selected",!0).parent().trigger("change")})}};jQuery(document).ready(function($){recipes.onReady()});